{
  "name": "model-seb-sir",
  "description": "SIR model with birth and death processes, white noise on the transmission term and overdispersed binomial observation process",
  "keywords": ["SIR", "overdispersed binomial", "2 cities", "paris", "new york"],
  "dependencies": {
    "data-seb-bar": "*"
  },
  "licenses": [
    {
      "type": "cc0",
      "url": "http://creativecommons.org/publicdomain/zero/1.0/"
    }
  ],

  "version": "0.0.0",

  "resources": [

    {
      "name": "populations",
      "data": [
        {"name": "paris", "composition": ["S_paris", "I_paris", "R_paris"], "remainder": {"name": "R_paris", "pop_size": "N_paris"}},
        {"name": "nyc",   "composition": ["S_nyc", "I_nyc", "R_nyc"],       "remainder": {"name": "R_nyc",   "pop_size": "N_nyc"}}
      ]
    },

    {
      "name": "reactions",
      "data":  [
        {"from": "U",       "to": "S_nyc",   "rate": "mu_b_nyc*N_nyc",             "description":"birth"},
        {"from": "U",       "to": "S_paris", "rate": "mu_b_paris*N_paris",         "description":"birth"},

        {"from": "S_nyc",   "to": "I_nyc",   "rate": "r0_nyc/N_nyc*v*I_nyc",       "description":"infection", "keywords": ["transmission"], "tracked": ["Inc_in_nyc"], "white_noise": {"name": "noise_SI", "sd": "sto"}},
        {"from": "S_paris", "to": "I_paris", "rate": "r0_paris/N_paris*v*I_paris", "description":"infection", "keywords": ["transmission"]},

        {"from": "I_nyc",   "to": "R_nyc",   "rate": "correct_rate(v)",            "description":"recovery", "tracked": ["Inc_out"]},
        {"from": "I_paris", "to": "R_paris", "rate": "correct_rate(v)",            "description":"recovery", "tracked": ["Inc_out"]},

        {"from": "S_nyc",   "to": "U",       "rate": "mu_d_nyc",                   "description":"death"},
        {"from": "S_paris", "to": "U",       "rate": "mu_d_paris",                 "description":"death"},

        {"from": "I_nyc",   "to": "U",       "rate": "mu_d_nyc",                   "description":"death", "tracked": ["Inc_out"]},
        {"from": "I_paris", "to": "U",       "rate": "mu_d_paris",                 "description":"death", "tracked": ["Inc_out"]}
      ]
    },

    {
      "name": "sde",
      "data": {
        "drift": [
          {"name": "r0_paris", "f": 0.0, "transformation": "log(r0_paris)"},
          {"name": "r0_nyc",   "f": 0.0, "transformation": "log(r0_nyc)"}
        ],
        "dispersion":[
          ["vol", 0],
          [0, "vol"]
        ]
      }
    },

    {
      "name": "observations",
      "data": [
        {
          "name": "all_CDC_inc",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "date"
                }
              },
              {
                "name": "data",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "all_CDC_inc"
                }
              }
            ]
          },
          "start": "2012-07-26",
          "pdf": {
            "distribution": "discretized_normal",
            "mean": "rep_all_CDC_inc * prop_all_CDC_inc * Inc_out",
            "sd": "sqrt(rep_all_CDC_inc * ( 1.0 - rep_all_CDC_inc ) * prop_all_CDC_inc * Inc_out + ( rep_all_CDC_inc * phi * prop_all_CDC_inc * Inc_out )^2 )"
          }
        },

        {
          "name": "paris_CDC_prev",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "date"
                }
              },
              {
                "name": "data",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "paris_CDC_prev"
                }
              }
            ]
          },
          "start": "2012-07-26",
          "pdf": {
            "distribution": "discretized_normal",
            "mean": "rep_paris_CDC_prev * prop_paris_CDC_prev * I_paris",
            "sd": "sqrt(rep_paris_CDC_prev * ( 1.0 - rep_paris_CDC_prev ) * prop_paris_CDC_prev * I_paris + ( rep_paris_CDC_prev * phi * prop_paris_CDC_prev * I_paris)^2 )"
          }
        },

        {
          "name": "all_google_inc",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "date"
                }
              },
              {
                "name": "data",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "all_google_inc"
                }
              }
            ]
          },
          "start": "2012-07-26",
          "pdf": {
            "distribution": "discretized_normal",
            "mean": "rep_all_google_inc * prop_all_google_inc * Inc_out",
            "sd": "sqrt(rep_all_google_inc * ( 1.0 - rep_all_google_inc ) * prop_all_google_inc * Inc_out + ( rep_all_google_inc * phi * prop_all_google_inc * Inc_out )^2 )"
          }
        },

        {
          "name": "nyc_CDC_inc",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "date"
                }
              },
              {
                "name": "data",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "data",
                  "field": "nyc_CDC_inc"
                }
              }
            ]
          },
          "start": "2012-07-26",
          "pdf": {
            "distribution": "discretized_normal",
            "mean": "rep_nyc_CDC_inc * prop_nyc_CDC_inc * Inc_in_nyc",
            "sd": "sqrt(rep_nyc_CDC_inc * ( 1.0 - rep_nyc_CDC_inc ) * prop_nyc_CDC_inc * Inc_in_nyc + ( rep_nyc_CDC_inc * phi * prop_nyc_CDC_inc * Inc_in_nyc )^2 )"
          }
        }
      ]
    },

    {
      "name": "parameters",
      "data": [

        {
          "name": "S_paris",
          "description": "Number of susceptible",
          "transformation": "pr_S_paris*N_paris",
          "to_prior": "S_paris/N_paris",
          "prior": {
            "name": "pr_S_paris",
            "description": "Proportion of susceptible",
            "distribution": "uniform",
            "lower":0.04,
            "upper":0.09
          }
        },

        {
          "name": "S_nyc",
          "description": "Proportion of susceptible",
          "transformation": "pr_S_paris*N_nyc"
        },

        {
          "name": "I_paris",
          "description": "Number of infectious",
          "keywords": ["infectious"],
          "transformation": "pr_I_paris*N_paris",
          "to_prior": "I_paris/N_paris",
          "prior": {
            "name": "pr_I_paris",
            "description": "Proportion of infectious",
            "distribution": "uniform",
            "lower": 1e-6,
            "upper": 1e-4
          }
        },

        {
          "name": "I_nyc",
          "description": "Number of infectious",
          "keywords": ["infectious"],
          "transformation": "10^-pr_I_nyc * N_nyc",
          "to_prior": "I_paris/N_paris",
          "prior": {
            "name": "pr_I_nyc",
            "description": "exponent (10^-x) to get a proportion of infectious",
            "distribution": "uniform",
            "lower": 4,
            "upper": 6
          }
        },

        {
          "name": "r0_paris",
          "description": "basic reproduction number",
          "prior": {
            "distribution": "uniform",
            "lower": 15.0,
            "upper": 35.0
          }
        },

        {
          "name": "r0_nyc",
          "description": "basic reproduction number",
          "prior": {
            "distribution": "uniform",
            "lower": 15.0,
            "upper": 35.0
          }
        },

        {
          "name": "vol",
          "description": "volatility of the diffusion",
          "prior": {
            "distribution": "fixed",
            "value": 0.1
          }
        },

        {
          "name": "v",
          "description": "recovery rate",
          "transformation": "1/pr_v",
          "prior": {
            "name": "pr_v",
            "description": "duration of infection",
            "distribution": "normal",
            "mean": 7.0,
            "sd": 2.0,
            "lower": 0.0,
            "unit": "day"
          }
        },

        {
          "name": "sto",
          "description": "noise intensity",
          "prior": {
            "distribution": "fixed",
            "value": 0.1
          }
        },

        {
          "name": "rep_all_CDC_inc",
          "description": "reporting rate",
          "prior": {
            "distribution": "uniform",
            "lower": 0.5,
            "upper": 0.8
          }
        },

        {
          "name": "rep_paris_CDC_prev",
          "description": "reporting rate",
          "prior": {
            "distribution": "uniform",
            "lower": 0.5,
            "upper": 0.8
          }
        },

        {
          "name": "rep_all_google_inc",
          "description": "reporting rate",
          "prior": {
            "distribution": "uniform",
            "lower": 0.5,
            "upper": 0.8
          }
        },

        {
          "name": "rep_nyc_CDC_inc",
          "description": "reporting rate",
          "prior": {
            "distribution": "uniform",
            "lower": 0.5,
            "upper": 0.8
          }
        },

        {
          "name": "phi",
          "description": "over-dispertion",
          "prior": {
            "distribution": "fixed",
            "value": 0.1
          }
        },

        {
          "name": "mu_b_paris",
          "description": "birth rate",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_b",
                  "field": "date"
                }
              },
              {
                "name": "mu_b",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_b",
                  "field": "paris"
                }
              }
            ]
          }
        },

        {
          "name": "mu_b_nyc",
          "description": "birth rate",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_b",
                  "field": "date"
                }
              },
              {
                "name": "mu_b",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_b",
                  "field": "nyc"
                }
              }
            ]
          }
        },

        {
          "name": "mu_d_paris",
          "description": "death rate",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_d",
                  "field": "date"
                }
              },
              {
                "name": "mu_d",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_d",
                  "field": "paris"
                }
              }
            ]
          }
        },

        {
          "name": "mu_d_nyc",
          "description": "death rate",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_d",
                  "field": "date"
                }
              },
              {
                "name": "mu_d",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "mu_d",
                  "field": "nyc"
                }
              }
            ]
          }
        },

        {
          "name": "N_paris",
          "description": "population size",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "N",
                  "field": "date"
                }
              },
              {
                "name": "N",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "N",
                  "field": "paris"
                }
              }
            ]
          }
        },

        {
          "name": "N_nyc",
          "description": "population size",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "N",
                  "field": "date"
                }
              },
              {
                "name": "N",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "N",
                  "field": "nyc"
                }
              }
            ]
          }
        },

        {
          "name": "prop_all_CDC_inc",
          "description": "proportion of the population under surveillance",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "date"
                }
              },
              {
                "name": "prop",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "all_CDC_inc"
                }
              }
            ]
          }
        },

        {
          "name": "prop_paris_CDC_prev",
          "description": "proportion of the population under surveillance",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "date"
                }
              },
              {
                "name": "paris_CDC_prev",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "all_google_inc"
                }
              }
            ]
          }
        },

        {
          "name": "prop_all_google_inc",
          "description": "proportion of the population under surveillance",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "date"
                }
              },
              {
                "name": "prop",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "all_google_inc"
                }
              }
            ]
          }
        },

        {
          "name": "prop_nyc_CDC_inc",
          "description": "proportion of the population under surveillance",
          "schema": {
            "fields":[
              {
                "name": "date",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "date"
                }
              },
              {
                "name": "prop",
                "foreignkey": {
                  "datapackage": "data-seb-bar",
                  "resource": "prop",
                  "field": "nyc_CDC_inc"
                }
              }
            ]
          }
        }
      ]
    }
  ]
}
